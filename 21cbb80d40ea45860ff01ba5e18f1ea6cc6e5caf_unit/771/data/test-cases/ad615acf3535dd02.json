{
  "uid" : "ad615acf3535dd02",
  "name" : "test_connection_token_caching",
  "fullName" : "tests.unit.db.test_connection#test_connection_token_caching",
  "historyId" : "8e228d6f90700599a2f6b220eaf58db1",
  "time" : {
    "start" : 1685472652747,
    "stop" : 1685472652821,
    "duration" : 74
  },
  "status" : "broken",
  "statusMessage" : "AttributeError: 'str' object has no attribute 'get_secret_value'",
  "statusTrace" : "settings = Settings(auth=None, user='email@domain.com', password='*****', access_token=None, account_name=None, server='api-dev.mock.firebolt.io', default_region='mock_region_1', use_token_cache=True)\ndb_name = 'database'\nhttpx_mock = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7ffa78875b90>\ncheck_credentials_callback = <function check_credentials_callback.<locals>.check_credentials at 0x7ffa784fe950>\nauth_url = 'https://api-dev.mock.firebolt.io/auth/v1/login'\nquery_callback = <function query_callback.<locals>.do_query at 0x7ffa7857e440>\nquery_url = URL('https://api-dev.mock.firebolt.io/?database=database&output_format=JSON_Compact')\npython_query_data = [[0, 256, 70000, -32768, 922337203685477580, -922337203685477580, ...], [1, 256, 70000, -32768, 922337203685477580, -9...337203685477580, -922337203685477580, ...], [5, 256, 70000, -32768, 922337203685477580, -922337203685477580, ...], ...]\naccess_token = 'mock_access_token'\n\n    @mark.nofakefs\n    def test_connection_token_caching(\n        settings: Settings,\n        db_name: str,\n        httpx_mock: HTTPXMock,\n        check_credentials_callback: Callable,\n        auth_url: str,\n        query_callback: Callable,\n        query_url: str,\n        python_query_data: List[List[ColType]],\n        access_token: str,\n    ) -> None:\n        httpx_mock.add_callback(check_credentials_callback, url=auth_url)\n        httpx_mock.add_callback(query_callback, url=query_url)\n    \n        # Using caching by default\n        with Patcher():\n            with connect(\n                database=db_name,\n                username=settings.user,\n>               password=settings.password.get_secret_value(),\n                engine_url=settings.server,\n                account_name=settings.account_name,\n                api_endpoint=settings.server,\n            ) as connection:\nE           AttributeError: 'str' object has no attribute 'get_secret_value'\n\ntests/unit/db/test_connection.py:304: AttributeError",
  "flaky" : false,
  "newFailed" : false,
  "beforeStages" : [ {
    "name" : "settings",
    "time" : {
      "start" : 1685472652745,
      "stop" : 1685472652745,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "auth_url",
    "time" : {
      "start" : 1685472652746,
      "stop" : 1685472652746,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "db_name",
    "time" : {
      "start" : 1685472652745,
      "stop" : 1685472652745,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "assert_all_responses_were_requested",
    "time" : {
      "start" : 1685472652745,
      "stop" : 1685472652745,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "server",
    "time" : {
      "start" : 1685472652744,
      "stop" : 1685472652744,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "access_token",
    "time" : {
      "start" : 1685472652746,
      "stop" : 1685472652746,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "check_credentials_callback",
    "time" : {
      "start" : 1685472652746,
      "stop" : 1685472652746,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "monkeypatch",
    "time" : {
      "start" : 1685472652745,
      "stop" : 1685472652745,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "username",
    "time" : {
      "start" : 1685472652745,
      "stop" : 1685472652745,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "query_data",
    "time" : {
      "start" : 1685472652746,
      "stop" : 1685472652746,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "python_query_data",
    "time" : {
      "start" : 1685472652747,
      "stop" : 1685472652747,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "query_callback",
    "time" : {
      "start" : 1685472652746,
      "stop" : 1685472652746,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "query_url",
    "time" : {
      "start" : 1685472652747,
      "stop" : 1685472652747,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "password",
    "time" : {
      "start" : 1685472652745,
      "stop" : 1685472652745,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "region_1",
    "time" : {
      "start" : 1685472652745,
      "stop" : 1685472652745,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "httpx_mock",
    "time" : {
      "start" : 1685472652746,
      "stop" : 1685472652746,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "provider",
    "time" : {
      "start" : 1685472652744,
      "stop" : 1685472652744,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "query_description",
    "time" : {
      "start" : 1685472652746,
      "stop" : 1685472652746,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "non_mocked_hosts",
    "time" : {
      "start" : 1685472652746,
      "stop" : 1685472652746,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "global_fake_fs",
    "time" : {
      "start" : 1685472652744,
      "stop" : 1685472652744,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  } ],
  "testStage" : {
    "status" : "broken",
    "statusMessage" : "AttributeError: 'str' object has no attribute 'get_secret_value'",
    "statusTrace" : "settings = Settings(auth=None, user='email@domain.com', password='*****', access_token=None, account_name=None, server='api-dev.mock.firebolt.io', default_region='mock_region_1', use_token_cache=True)\ndb_name = 'database'\nhttpx_mock = <pytest_httpx._httpx_mock.HTTPXMock object at 0x7ffa78875b90>\ncheck_credentials_callback = <function check_credentials_callback.<locals>.check_credentials at 0x7ffa784fe950>\nauth_url = 'https://api-dev.mock.firebolt.io/auth/v1/login'\nquery_callback = <function query_callback.<locals>.do_query at 0x7ffa7857e440>\nquery_url = URL('https://api-dev.mock.firebolt.io/?database=database&output_format=JSON_Compact')\npython_query_data = [[0, 256, 70000, -32768, 922337203685477580, -922337203685477580, ...], [1, 256, 70000, -32768, 922337203685477580, -9...337203685477580, -922337203685477580, ...], [5, 256, 70000, -32768, 922337203685477580, -922337203685477580, ...], ...]\naccess_token = 'mock_access_token'\n\n    @mark.nofakefs\n    def test_connection_token_caching(\n        settings: Settings,\n        db_name: str,\n        httpx_mock: HTTPXMock,\n        check_credentials_callback: Callable,\n        auth_url: str,\n        query_callback: Callable,\n        query_url: str,\n        python_query_data: List[List[ColType]],\n        access_token: str,\n    ) -> None:\n        httpx_mock.add_callback(check_credentials_callback, url=auth_url)\n        httpx_mock.add_callback(query_callback, url=query_url)\n    \n        # Using caching by default\n        with Patcher():\n            with connect(\n                database=db_name,\n                username=settings.user,\n>               password=settings.password.get_secret_value(),\n                engine_url=settings.server,\n                account_name=settings.account_name,\n                api_endpoint=settings.server,\n            ) as connection:\nE           AttributeError: 'str' object has no attribute 'get_secret_value'\n\ntests/unit/db/test_connection.py:304: AttributeError",
    "steps" : [ ],
    "attachments" : [ {
      "uid" : "82d91c359903f81b",
      "name" : "log",
      "source" : "82d91c359903f81b.txt",
      "type" : "text/plain",
      "size" : 410
    } ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 1,
    "shouldDisplayMessage" : true,
    "hasContent" : true
  },
  "afterStages" : [ {
    "name" : "monkeypatch::0",
    "time" : {
      "start" : 1685472652835,
      "stop" : 1685472652835,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  }, {
    "name" : "httpx_mock::0",
    "time" : {
      "start" : 1685472652833,
      "stop" : 1685472652834,
      "duration" : 1
    },
    "status" : "failed",
    "statusMessage" : "AssertionError: The following responses are mocked but not requested:\n  Match all requests on https://api-dev.mock.firebolt.io/auth/v1/login\n  Match all requests on https://api-dev.mock.firebolt.io/?database=database&output_format=JSON_Compact\nassert not [<pytest_httpx._httpx_mock._RequestMatcher object at 0x7ffa78449e50>, <pytest_httpx._httpx_mock._RequestMatcher object at 0x7ffa78449910>]\n",
    "statusTrace" : "  File \"/opt/hostedtoolcache/Python/3.7.16/x64/lib/python3.7/site-packages/allure_commons/_allure.py\", line 221, in __call__\n    return self._fixture_function(*args, **kwargs)\n  File \"/opt/hostedtoolcache/Python/3.7.16/x64/lib/python3.7/site-packages/_pytest/fixtures.py\", line 941, in _teardown_yield_fixture\n    next(it)\n  File \"/opt/hostedtoolcache/Python/3.7.16/x64/lib/python3.7/site-packages/pytest_httpx/__init__.py\", line 65, in httpx_mock\n    mock.reset(assert_all_responses_were_requested)\n  File \"/opt/hostedtoolcache/Python/3.7.16/x64/lib/python3.7/site-packages/pytest_httpx/_httpx_mock.py\", line 309, in reset\n    assert (\n",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : true,
    "hasContent" : true
  }, {
    "name" : "global_fake_fs::0",
    "time" : {
      "start" : 1685472652837,
      "stop" : 1685472652837,
      "duration" : 0
    },
    "status" : "passed",
    "steps" : [ ],
    "attachments" : [ ],
    "parameters" : [ ],
    "stepsCount" : 0,
    "attachmentsCount" : 0,
    "shouldDisplayMessage" : false,
    "hasContent" : false
  } ],
  "labels" : [ {
    "name" : "tag",
    "value" : "nofakefs"
  }, {
    "name" : "parentSuite",
    "value" : "tests.unit.db"
  }, {
    "name" : "suite",
    "value" : "test_connection"
  }, {
    "name" : "host",
    "value" : "fv-az180-961"
  }, {
    "name" : "thread",
    "value" : "2340-MainThread"
  }, {
    "name" : "framework",
    "value" : "pytest"
  }, {
    "name" : "language",
    "value" : "cpython3"
  }, {
    "name" : "package",
    "value" : "tests.unit.db.test_connection"
  }, {
    "name" : "resultFormat",
    "value" : "allure2"
  } ],
  "parameters" : [ ],
  "links" : [ ],
  "hidden" : false,
  "retry" : false,
  "extra" : {
    "severity" : "normal",
    "retries" : [ ],
    "categories" : [ {
      "name" : "Test defects",
      "matchedStatuses" : [ ],
      "flaky" : false
    } ],
    "tags" : [ "nofakefs" ]
  },
  "source" : "ad615acf3535dd02.json",
  "parameterValues" : [ ]
}